需求文档：ChatGPT 模式快捷切换插件（浏览器扩展）
1. 背景与目标
1.1 背景

ChatGPT 网页端的“模式/档位”切换位于下拉菜单中，属于高频但被隐藏的操作。用户在不同任务（查资料、写代码、深度推理）之间切换时，频繁展开菜单导致时间损耗与注意力中断。

1.2 目标

在不改变 ChatGPT 核心使用体验的前提下：

将所有模式/档位以“平铺按钮”的形式固定展示在页面显眼位置。

为每个档位提供可自定义的快捷键（全局或页面内）。

一键切换成功率高、反馈明确、可恢复（切回上一个模式）。

兼容 ChatGPT 页面迭代，降低 DOM 变动导致的失效概率。

1.3 非目标

不实现自动提示词优化、自动发送消息、自动化对话流程（避免越界和复杂度失控）。

不做账号管理、订阅识别、计费相关功能。

2. 用户画像与使用场景
2.1 用户画像

重度 ChatGPT 用户（Pro/Plus/企业用户，日均多次切换模式）

工程师/研究/写作人员，常在“快问快答”与“深度推理”之间切换

2.2 场景

场景 A：排查问题时，先 Instant 快速问，再切 Thinking Extended 深挖

场景 B：写文案用 Standard，遇到复杂论证切 Heavy

场景 C：做严谨推理/长文/复杂代码，直接切 Pro Extend

3. 功能需求（FRD）
3.1 模式平铺面板（核心）

描述：在 ChatGPT 页面固定区域渲染一个“模式面板”，包含所有档位按钮。

模式列表（初始）

Auto

Instant

Thinking：Light / Standard / Extended / Heavy

Pro：Pro / Extend

交互

点击按钮 → 触发切换模式动作

当前选中状态高亮

鼠标悬停显示 tooltip：模式名 + 快捷键 + 简短说明（可选）

位置

默认：输入框上方右侧（不遮挡输入与发送按钮）

可配置：顶部栏、侧边栏、输入框上方/下方（通过设置项切换）

成功反馈

切换成功：按钮高亮、toast “Switched to XXX”

切换失败：toast “Switch failed, retry?” + 重试按钮

3.2 快捷键系统（核心）

描述：为每个档位绑定快捷键，实现无需鼠标的瞬时切换。

默认快捷键建议（可改）

Auto：Alt + 1

Instant：Alt + 2

Thinking Light：Alt + 3

Thinking Standard：Alt + 4

Thinking Extended：Alt + 5

Thinking Heavy：Alt + 6

Pro：Alt + 7

Pro Extend：Alt + 8

切回上一个模式：Alt + 0

说明：建议使用 Alt 组合键以降低与网页常用快捷键冲突；最终以可配置为准。

要求

快捷键可在扩展设置页配置

冲突检测：若与浏览器/系统快捷键冲突，提示用户更换

支持“仅在 ChatGPT 页面生效”

3.3 模式切换执行策略（核心）

描述：插件需要可靠触发 ChatGPT 官方 UI 的模式切换。

优先级策略

优先调用页面内可用的公开接口/事件（若存在）

否则通过模拟 UI 操作：打开模式菜单 → 点击目标项

DOM 变更容错：使用语义定位（文本/aria-label/data-testid），不依赖脆弱的层级选择器

健壮性

使用 MutationObserver 监听菜单节点出现后再点击

失败重试：短间隔最多重试 2 次

当页面未加载完或不在对话页面时，按钮禁用并提示状态

3.4 状态同步与持久化（重要）

描述：插件显示的“当前模式”必须与页面真实模式保持一致。

要求

页面模式变化（用户手动通过菜单切换）时，面板同步更新

记住用户最近一次选择（可配置）：

进入新对话时沿用上次模式

或每个会话记忆不同模式（可选增强）

3.5 设置页（重要）

设置项

面板位置（top/side/input-above/input-below）

快捷键配置（每个模式独立）

是否显示 tooltip / toast

是否启用“切回上一个模式”

主题：跟随系统 / 浅色 / 深色

安全项：是否允许“自动打开菜单并点击”（默认允许，因为这是核心）

4. 非功能需求（NFR）
4.1 性能

面板渲染不应明显影响页面性能（目标：额外 CPU 占用接近 0）

MutationObserver 只监听必要容器，避免全局监听导致卡顿

4.2 兼容性

Chrome / Edge（Manifest V3）

适配 ChatGPT 页面布局变化：通过多策略定位与降级提示

4.3 安全与隐私

不读取、不上传对话内容

不采集用户输入、cookie、token

权限最小化：仅匹配 chat.openai.com / chatgpt.com（按实际域名配置）

设置数据仅存储在浏览器本地 storage

4.4 可用性

按钮可键盘聚焦（Tab 导航），支持 Enter/Space 切换

在移动端不做支持（非目标）

5. UI/交互草图（文字版）

[Auto] [Instant] | Thinking: [Light] [Standard] [Extended] [Heavy] | Pro: [Pro] [Extend]

当前模式按钮高亮

右侧有一个齿轮（⚙）进入设置页

6. 边界与异常处理

未登录/登录过期：面板显示“Not logged in”并禁用

页面结构变化导致定位失败：

toast 提示“UI changed, please update extension”

提供“Report issue”链接（可选）

模式不可用（例如账号没有某档位）：

自动隐藏该按钮，或置灰并提示“Not available”

7. 验收标准（AC）

面板在 ChatGPT 对话页稳定显示，刷新后仍在

点击任意按钮能在 2 秒内完成模式切换并高亮同步

每个模式快捷键可用，且在输入框聚焦时不误触（可配置：输入时禁用/仍可用）

用户用原生菜单切换模式，面板能同步更新

不请求与功能无关的权限；插件不上传任何对话内容

ChatGPT 页面小幅 DOM 调整时仍具备一定容错（不因 class 名变化立即失效）

8. 里程碑（建议）

M1：可用版（平铺按钮 + 点击切换 + 状态高亮）

M2：快捷键 + 设置页

M3：健壮性增强（多策略定位、失败重试、可用性检测、灰度隐藏不可用档位）

